
## 第19章 18B20

### 19.1 1-Wire 通信协议   

#### ① 概述

```
异步、串行、半双工
```

#### ② 初始化

```
1. 主设备发送复位脉冲（DQ=0），并至少持续480us
2. 主设备释放DQ并等待15~60us （该时间之后，从设备才会发送存在脉冲）
3. 主设备读取从设备存在脉冲（DQ数据），至少延时480us（等待时间+后面的采样时间）再进行后续的操作
```

#### ③ 写操作（发送）

```
1. 先发低位，再发高位
2. 每发送一个bit的数据：
   2.1 主设备拉低DQ
   2.2 主设备要在15us内，将当前的bit信息发送到DQ
   2.3 发送1个bit的数据共需要持续60~120us
   2.4 发送完一个bit的数据需要将DQ释放，并至少持续1us
```

#### ④ 读操作（接收）

```
1. 先接收低位，再接收高位
2. 每接收一个bit的数据：
   2.1 主设备将DQ拉低，至少持续1us，然后释放DQ
   2.2 延时15us，读取DQ上的数据（从设备会在DQ被释放15us之内发送DQ发送数据，此处延时10us，也可以）
   2.3 接收1个bit的数据共需要持续60~120us
```

### 19.2 18B20 通信流程

#### ① 初始化

#### ② 发送 ROM 命令

```

```

#### ③ 发送功能命令

```

```



## 第20章 DS1302 实时时钟

### 20.1 通信协议（三线串行通信）

> DS1302 实时时钟芯片主要使用的是一个类似于SPI (Serial Peripheral Interface) 的三线通信协议来与微控制器进行通信。 

#### ① 发送（写操作）

```
1. 发送命令字节
2. 发送数据字节
```

```
单片机在上升沿前发，1302在上升沿的时候收
```

#### ② 接收（读操作）

```
1. 发送命令字节
2. 接收数据字节
```

```
1302在下降沿的时候发，单片机在下降沿之后收
```



### 20.2 DS1302

```
秒寄存器
分钟寄存器
小时寄存器
Date寄存器（每月第几天）
Day寄存器（每周第几天）
月寄存器
年寄存器
写保护寄存器
```



## 附录

### 单词

```
wire		线
temperature	温度
```



### 51扩展板引脚参考

| 引脚                   | 对应模块                               |
| ---------------------- | -------------------------------------- |
| P00 ~ P01              | 流水灯 /  数码管段选                   |
| P10 | 595 SER输入 |
| P11 | 595 RCK输入 |
| P12 | 595 SCK输入 |
| P13 ~ P15              | 数码管位选                             |
| P16 | I²C 数据线 |
| P17 | I²C 时钟线 |
| P20 ~ P23				 | 矩阵按键 1 ~ 4 行	|
| P24 ~ P27					|矩阵按键 1 ~ 4 列 					|
| P30/RxD | 串口数据接收端 |
| P31/TxD | 串口数据发送端 |
| P32                    | 独立按键SW3 / 外部中断0 / Timer0计数启动  |
| P33                    | 独立按键SW4 / 外部中断1 / Timer1计数启动  |
| P34                    | 流水灯开关(1开) /  Timer0脉冲源     |
| P35 | Timer1脉冲源 / 点阵LED开关(0开) |
| P36                    | 数码管开关(0开)                  |
| P42 				| 独立按键SW1 / 外部中断3     |
| P43 | 独立按键 SW2 / 外部中断2 |
| P44 | 1-wire总线 |
| P46                    | 蜂鸣器                                 |






