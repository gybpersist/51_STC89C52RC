
## 第16章 UART通信

### 16.1 通信简介

#### ① 串行通信和并行通信

```
串行：使用一根数据线逐位传输
并行：使用多根数据线同时传输
```

|                | **串行** | **并行** |
| -------------- | -------- | -------- |
| **传输速率**   | 低       | 高       |
| **硬件成本**   | 低       | 高       |
| **抗干扰能力** | 高       | 低       |
| **通讯距离**   | 高       | 低       |

#### ② 单工通信和双工通信

```
单工： 数据传输方向是单向的

双工： 数据传输方向是双向的
	半双工：发送和接收不能同时进行
	全双工：发送和接收可以同时进行
```

#### ③ 同步通信和异步通信

```
同步通信：需要时钟信号线，发送方和接收方频率一致
异步通信：不需要时钟信号线，发送方和接收方频率不一定一致
```



### 16.2 UART 协议介绍

#### ① UART 概述

```
全称：Universal Asynchronous Receiver/Transmitter， 通用异步收发协议
特点：串行、全双工、异步
```

#### ② 数据格式

```
1. 起始位，低电平
2. 数据位 (5~9位，通常8位）
3. 校验位（分为奇校验和偶校验，可省略）
4. 停止位（1到2位），高电平
```

#### ③ 发送方和接收方约定

```
1. 波特率
2. 数据位数
3. 校验位
3. 停止位
```

### 16.3 51单片机 UART 使用步骤

#### ① 初始化操作

**设置工作模式：**

``` 
工作模式0：同步移位
工作模式1: 8位UART，数据位+校验位共8位，波特率可配置
工作模式2: 9位UART，数据位+校验位共9位，波特率固定
工作模式3: 9位UART，数据位+校验位共9位，波特率可配置
```

```
SCON寄存器中的 SM0和SM1 两个控制位可以配置串口工作模式
```

**设置波特率和定时器1：**

```
① 设置是否2分频，PCON寄存器中的SMOD控制位为0表示需要2分频
② 配置定时器1为工作模式2,8位自动重装载
③ 根据波特率计算溢出率，进而计算脉冲计数器的起始值
④ 定时器1开始计数
```

**接收串口设置：**

```c
① 允许接收数据，SCON寄存器中的REN控制位，置1
② 是否检测停止位，SCON寄存器中的SM2控制位，模式1下，SM2置0不检测停止位
```

**串口中断设置：**

```
① 打开中断开关， 总开关(EA)和串口中断开关(ES)
② 可以设置串口中断优先级
③ 定义串口中断服务程序
  发送完一帧数据，TI标志位由硬件置1，触发串口中断； TI需要软件复位。
  接收完一帧数据，RI标志位由硬件置1，触发串口中断； RI需要软件复位。
```

#### ③ 发送数据

```c
向SBUF(发送缓冲器)寄存器写入数据
```

#### ④ 接收数据

```c
读取SBUF（接收缓冲器）寄存器中的数据
```

> 发送缓存器和接收缓冲器是两个寄存器共用一个地址，发送缓冲器只能写入，接收缓冲器只能读取。





## 附录

### 相关单词

```
serial 			串行
parallel 		并行
simplex			单工
duplex			双工
half-duplex		半双工
full-duplex 	半双工
synchronous		同步
asynchronous	异步
universal		通用
receiver		接收器
transmitter		发射器
Integrated Circuit	集成电路
Inter			在...之间
Acknowledge		告知收到
Electrically 	电
Erasable 		可擦除
Programmable 	可编程
Current			当前的
Random 			随机的
Sequential 		连续的
Dummy 			假的
```

### 相关寄存器

**SCON：** Serial Control，串口控制寄存器。

**PCON：** Power Control，电源控制寄存器。

**SBUF：** Serial Buffer，串口缓冲寄存器。

### 51扩展板引脚参考

| 引脚      | 对应模块                                 |
| --------- | ---------------------------------------- |
| P00 ~ P01 | 流水灯 /  数码管段选                     |
| P10       | 595 SER输入                              |
| P11       | 595 RCK输入                              |
| P12       | 595 SCK输入                              |
| P13 ~ P15 | 数码管位选                               |
| P16       | I²C 数据线                               |
| P17       | I²C 时钟线                               |
| P20 ~ P23 | 矩阵按键 1 ~ 4 行                        |
| P24 ~ P27 | 矩阵按键 1 ~ 4 列                        |
| P30/RxD   | 串口数据接收端                           |
| P31/TxD   | 串口数据发送端                           |
| P32       | 独立按键SW3 / 外部中断0 / Timer0计数启动 |
| P33       | 独立按键SW4 / 外部中断1 / Timer1计数启动 |
| P34       | 流水灯开关(1开) /  Timer0脉冲源          |
| P35       | Timer1脉冲源 / 点阵LED开关(0开)          |
| P36       | 数码管开关(0开)                          |
| P42       | 独立按键SW1 / 外部中断3                  |
| P43       | 独立按键 SW2 / 外部中断2                 |
| P46       | 蜂鸣器                                   |